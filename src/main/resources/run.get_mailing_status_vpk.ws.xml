<?xml version="1.0" encoding="UTF-8"?>
<xq:process name="run.get_mailing_status_vpk.ws" processModelVersion="3.0" qualityOfService="BEST_EFFORT" timeToLive="0" xmlns:wsis="http://www.sonicsw.com/esb/service/invocation" xmlns:xq="http://www.sonicsw.com/sonicxq">
  <xq:exitEndpoint_list>
    <xq:exitEndpoint endpoint_ref="REPLY_TO" type="ENDPOINT"/>
  </xq:exitEndpoint_list>
  <xq:faultEndpoint endpoint_ref="REPLY_TO" type="ENDPOINT"/>
  <xq:rejectEndpoint endpoint_ref="RME" type="ENDPOINT"/>
  <xq:itinerary>
    <xq:transform name="add journal headers">
      <xq:messageMapping>
        <xq:property name="cloneMessage" value="false"/>
        <xq:mapInput>
          <xq:rule action="XQMsgBulkDelete" source="${esbmsg.selectHeaders['Authorization']}" target="${esbpStepInMsg.headers}"/>
          <xq:rule source="xecm" target="${esbpStepInMsg.headers['JOURN.systemName']}"/>
          <xq:rule source="get_mailing_status_vpk" target="${esbpStepInMsg.headers['JOURN.processName']}"/>
        </xq:mapInput>
      </xq:messageMapping>
    </xq:transform>
    <xq:step name="Call sup_header_new_trans" type="PROCESS" endpoint_ref="sup_header_new_trans"/>
    <xq:step name="Wrap in RunScript" type="SERVICE" endpoint_ref="Transform">
      <xq:params>
        <xq:stringParam name="stylesheetURL" url="sonicfs:///RosEuroBank/MailingWS/resources/xsl/wrap_RunScript_status.xsl"/>
        <xq:stringParam name="msgPartIndex">pack_data</xq:stringParam>
        <xq:xmlParam name="helperFiles"/>
        <xq:stringParam name="validating">false</xq:stringParam>
        <xq:stringParam name="namespaceAware">true</xq:stringParam>
        <xq:stringParam name="useTemplates">true</xq:stringParam>
        <xq:stringParam name="dropDefaultOutput">false</xq:stringParam>
      </xq:params>
    </xq:step>
    <xq:step name="Call sup_header_out_start" type="PROCESS" endpoint_ref="sup_header_out_start"/>
    <xq:step name="Call RunScript" description="" type="SERVICE" endpoint_ref="Directum.API.WS">
      <xq:params>
        <xq:stringParam name="esbcamelBeanId">IntegrationServices.AnonimousHttpIntegration.RunScript</xq:stringParam>
      </xq:params>
      <xq:messageMapping>
        <xq:mapInput>
          <xq:rule source="${esbmsg.parts['pack_data'].content}" target="${esbdl.input['parameters']}"/>
        </xq:mapInput>
        <xq:mapOutput>
          <xq:rule source="${esbdl.output['parameters'].value}" target="${esbmsg.parts[xq:newPart('response', 'text/xml')]}"/>
        </xq:mapOutput>
      </xq:messageMapping>
    </xq:step>
    <xq:step name="fill response" type="SERVICE" endpoint_ref="Transform">
      <xq:params>
        <xq:stringParam name="stylesheetURL" url="sonicfs:///RosEuroBank/MailingWS/resources/xsl/transform_response_status.xsl"/>
        <xq:stringParam name="msgPartIndex">response</xq:stringParam>
        <xq:xmlParam name="helperFiles"/>
        <xq:stringParam name="validating">false</xq:stringParam>
        <xq:stringParam name="namespaceAware">true</xq:stringParam>
        <xq:stringParam name="useTemplates">true</xq:stringParam>
        <xq:stringParam name="dropDefaultOutput">false</xq:stringParam>
      </xq:params>
    </xq:step>
    <xq:step name="copy response to pack_data" type="SERVICE" endpoint_ref="supj_part_clonerInstance">
      <xq:params>
        <xq:stringParam name="source_part_content_id">response</xq:stringParam>
        <xq:stringParam name="target_part_content_id">pack_data</xq:stringParam>
        <xq:stringParam name="remove_sourse_part">false</xq:stringParam>
      </xq:params>
    </xq:step>
    <xq:step name="Call sup_header_out_fin" type="PROCESS" endpoint_ref="sup_header_out_fin"/>
    <xq:step name="Call sup_header_fin_trans" type="PROCESS" endpoint_ref="sup_header_fin_trans"/>
    <xq:exit name="Exit 1"/>
  </xq:itinerary>
  <xq:trackingDetails trackingLevel="0">
    <xq:eventEndpoint endpoint_ref="Broker_Tracking.Entry" type="ENDPOINT"/>
    <xq:idGenerator class="com.sonicsw.xqimpl.service.accessor.ScriptEvaluator"/>
  </xq:trackingDetails>
  <xq:interface>
    <xq:operation xsi:schemaLocation="urn:ESB.mailing_vpk/service file:///C:/Sonic2015/Workbench10.0/workspace/MailingWS/resources/wsdl/mailing_vpkWS.wsdl" xmlns:prefix="urn:ESB.mailing_vpk/service" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <xq:input name="DefaultInput">
        <xq:parameter collection="false" name="pack_data" type="prefix:mailing_status_WSRequest" metatype="element">
          <xq:esbBinding>
            <xq:part contentId="pack_data"/>
          </xq:esbBinding>
        </xq:parameter>
      </xq:input>
      <xq:output name="DefaultOutput">
        <xq:parameter collection="false" name="pack_data" type="prefix:mailing_status_WSResponse" metatype="element">
          <xq:esbBinding>
            <xq:part contentId="pack_data"/>
          </xq:esbBinding>
        </xq:parameter>
      </xq:output>
    </xq:operation>
  </xq:interface>
</xq:process>